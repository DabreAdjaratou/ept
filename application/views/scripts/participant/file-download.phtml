<?php 
//Zend_Debug::dump($this->download);die;
?>
<section class="content-header">
    <h1>
        Download
    </h1>
</section>
<section class="content">
<div class="box">
<div class="box-body">
<div id="view-content">
	<table class="table table-striped table-bordered" id="myTable">	
        <thead><tr><th>Unique Identifier</th><th>Lab Name</th><th>Download File</th><th>Date</th></tr></thead>
    <tbody>
        <?php
         $filePath = "/var/www/".$_SERVER['SERVER_NAME']."/downloads/";
         $arrCount = count($this->download);
         $this->download[$arrCount]['unique_identifier'] = 'all';
         if(count($this->download)>0){
            foreach($this->download as $uniqueId){
                $path = $filePath.$uniqueId['unique_identifier'];
                if(is_dir($path) && count(scandir($path))>2){
                    $lab = (isset($uniqueId['lab_name']) && $uniqueId['lab_name']!='') ? $uniqueId['lab_name']:"";
                    ?>
                    <?php
                    $files = array();
                    foreach(scandir($path) as $fileName){
                        if($fileName!='.' && $fileName!='..'){
                            $files[$fileName] = filemtime($path."/".$fileName);
                        }
                    }
                    if(count($files)>0){
                    arsort($files);
                        foreach(array_keys($files) as $descFile){
                        ?>
                            <tr>
                                <td><?php echo ucfirst($uniqueId['unique_identifier']);?></td>
                                <td><?php echo ucfirst($lab);?></td>
                                <td><a href="javascript:void(0);" onclick="getFile('<?php echo $descFile;?>','<?php echo $uniqueId['unique_identifier'];?>');"><?php echo $descFile;?></a></td>
                                <td><?php echo date("d-M-Y H:i:s", filemtime($path."/".$descFile));?></td>
                            </tr>
                        <?php
                        }
                    }
                }
            }
         }
        ?>
        </tbody>
	</table>
</div>
</div>
</div>
</section>
<script>
    $(document).ready(function () {
        $('#myTable').dataTable({"ordering": false});
    });
    function getFile(fileName,uniqueId) {
        window.location.href="download-file-details?fileName="+fileName+"&uniqueId="+uniqueId;
    }
</script>